<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>DNS Query</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  >
</head>

<body>
<div class="container mt-4">

  <p>
    This app will query Infoblox and return its FQDN, IP Address, and Network Containers.
    <br>
    You can also enter a network ID to list its Network Containers.
  </p>

  <form id="dnsForm" autocomplete="off">
    <div class="mb-3">
      <label for="ip" class="form-label">Hostname or IP Address</label>
      <input id="ip" name="ip" type="text" class="form-control">
    </div>

    <button id="submitBtn" type="submit" class="btn btn-success">
      Go!
    </button>
  </form>

  <hr>

  <pre id="result" class="bg-light p-3 mt-3"></pre>

</div>
<script>
  const QUERY_API_URL = "{{ url_for('api_querydns') }}";
</script>
<script>
document.getElementById("dnsForm").addEventListener("submit", function (e) {
    e.preventDefault();

    const ip = document.getElementById("ip").value.trim();
    const resultBox = document.getElementById("result");
    const btn = document.getElementById("submitBtn");

    if (!ip) {
        resultBox.textContent = "Please enter a hostname or IP address.";
        return;
    }

    btn.disabled = true;
    resultBox.textContent = "Querying Infoblox...";

    fetch(`${QUERY_API_URL}?ip=${encodeURIComponent(ip)}`)
        .then(res => {
            if (!res.ok) {
                return res.json().then(err => {
                    throw new Error(err.error || "Request failed");
                });
            }
            return res.json();
        })
        .then(data => {
            resultBox.textContent = data.result;
        })
        .catch(err => {
            resultBox.textContent = err.message;
        })
        .finally(() => {
            btn.disabled = false;
        });
});
</script>

</body>
</html>
